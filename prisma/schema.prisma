generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}


enum Gender {
  male
  female
  non_binary
  prefer_not_to_say
}

enum SmokingPreference {
  YES
  NO
  OCCASIONALLY
}

enum DrinkingPreference {
  YES
  NO
  OCCASIONALLY
  SOCIALLY
}

enum PetsPreference {
  HAS_PETS
  NO_PETS
  OPEN_TO_PETS
}

enum SleepSchedule {
  EARLY_BIRD
  NIGHT_OWL
  FLEXIBLE
}

enum Cleanliness {
  VERY_CLEAN
  MODERATELY_CLEAN
  RELAXED
}

enum TeamRole {
  LEADER
  MEMBER
}

enum TeamMemberStatus {
  PENDING
  ACCEPTED
  REJECTED
}

enum NotificationType {
  TEAM_INVITE
  TEAM_JOIN_REQUEST
  TEAM_MEMBER_ACCEPTED
  NEW_MESSAGE
  LISTING_INQUIRY
  REVIEW_RECEIVED
}

model User {
  id           String    @id @default(uuid())
  email        String    @unique
  phone        String?   @unique
  passwordHash String    @map("password_hash")

  // Basic Profile
  firstName String? @map("first_name")
  lastName  String? @map("last_name")
  age       Int?
  gender    Gender?
  city      String?
  bio       String? @db.VarChar(500)
  
  // Lifestyle & Preferences
  occupation         String?
  smokingPreference  SmokingPreference?  @map("smoking_preference")
  drinkingPreference DrinkingPreference? @map("drinking_preference")
  petsPreference     PetsPreference?     @map("pets_preference")
  sleepSchedule      SleepSchedule?      @map("sleep_schedule")
  cleanliness        Cleanliness?
  
  // Budget & Location
  budgetMin       Int? @map("budget_min")
  budgetMax       Int? @map("budget_max")
  preferredRadius Int? @map("preferred_radius")
  
  // Interests & Languages
  interests String[]
  languages String[]
  
  // Photos
  profilePhoto     String?   @map("profile_photo")
  additionalPhotos String[]  @map("additional_photos")

  // Verification
  emailVerified Boolean @default(false) @map("email_verified")
  phoneVerified Boolean @default(false) @map("phone_verified")

  // Status
  isActive Boolean @default(true) @map("is_active")

  // Timestamps
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")
  lastLoginAt DateTime? @map("last_login_at")

  // Relations
  refreshTokens      RefreshToken[]
  listings           Listing[]
  conversationsUser1 Conversation[] @relation("ConversationUser1")
  conversationsUser2 Conversation[] @relation("ConversationUser2")
  messages           Message[]
  blockedBy          Block[]        @relation("BlockedBy")
  blocks             Block[]        @relation("Blocks")
  reportsMade        Report[]       @relation("ReportsMade")
  reportsReceived    Report[]       @relation("ReportsReceived")
  favorites          Favorite[]
  teamMembers        TeamMember[]
  reviewsGiven       Review[]       @relation("ReviewsGiven")
  reviewsReceived    Review[]       @relation("ReviewsReceived")
  notifications      Notification[]

  @@map("users")
}

model RefreshToken {
  id        String   @id @default(uuid())
  userId    String   @map("user_id")
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  token     String   @unique
  expiresAt DateTime @map("expires_at")
  createdAt DateTime @default(now()) @map("created_at")

  @@index([userId])
  @@map("refresh_tokens")
}

// ─── Listing System Enums ───────────────────────────────────────

enum ListingType {
  HAVE_ROOM
  NEED_ROOM
}

enum PropertyType {
  APARTMENT
  HOUSE
  STUDIO
  SHARED_ROOM
  PRIVATE_ROOM
}

enum FurnishedStatus {
  FULLY_FURNISHED
  SEMI_FURNISHED
  UNFURNISHED
}

enum GenderPreference {
  MALE
  FEMALE
  ANY
}

// ─── Listing Model ──────────────────────────────────────────────

model Listing {
  id          String      @id @default(uuid())
  userId      String      @map("user_id")
  user        User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  // Listing Type
  type        ListingType
  title       String      @db.VarChar(100)
  description String      @db.VarChar(1000)
  
  // Financial
  rent        Int         // Monthly rent
  deposit     Int         // Security deposit
  currency    String      @default("INR")
  
  // Location
  city        String
  area        String?     // Neighborhood/locality
  address     String?     // Full address (private)
  latitude    Float?
  longitude   Float?
  
  // Property Details (only for HAVE_ROOM)
  propertyType    PropertyType?
  furnishedStatus FurnishedStatus?
  bathrooms       Int?
  amenities       String[]        // ["WiFi", "Parking", "Gym", "AC"]
  
  // Preferences
  genderPreference   GenderPreference?
  occupationPreference String[]      // ["Student", "Working Professional"]
  smokingAllowed     Boolean?
  petsAllowed        Boolean?
  
  // Availability
  availableFrom  DateTime
  availableUntil DateTime?
  
  // Media
  photos String[] // Array of image URLs
  
  // Status
  isActive   Boolean @default(true) @map("is_active")
  viewCount  Int     @default(0) @map("view_count")
  
  // Timestamps
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  
  // Relations (placeholders for future phases)
  conversations Conversation[]
  favorites     Favorite[]
  reports       Report[]
  
  @@index([city, rent, isActive])
  @@index([type, city, createdAt])
  @@index([userId])
  @@map("listings")
}

// ─── Messaging System Models ───────────────────────────────────

model Conversation {
  id        String   @id @default(uuid())
  user1Id   String   @map("user1_id")
  user2Id   String   @map("user2_id")
  user1     User     @relation("ConversationUser1", fields: [user1Id], references: [id], onDelete: Cascade)
  user2     User     @relation("ConversationUser2", fields: [user2Id], references: [id], onDelete: Cascade)
  
  // Optional listing context (what listing started this conversation)
  listingId String?  @map("listing_id")
  listing   Listing? @relation(fields: [listingId], references: [id], onDelete: SetNull)
  
  // Optional team context (for team conversations)
  teamId    String?  @map("team_id")
  team      Team?    @relation(fields: [teamId], references: [id], onDelete: SetNull)
  
  // Timestamps
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  
  // Relations
  messages Message[]
  
  @@unique([user1Id, user2Id])
  @@index([user1Id])
  @@index([user2Id])
  @@map("conversations")
}

model Message {
  id             String       @id @default(uuid())
  conversationId String       @map("conversation_id")
  conversation   Conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  
  senderId       String       @map("sender_id")
  sender         User         @relation(fields: [senderId], references: [id], onDelete: Cascade)
  
  // Message content
  content        String       @db.VarChar(1000)
  
  // Read status
  isRead         Boolean      @default(false) @map("is_read")
  readAt         DateTime?    @map("read_at")
  
  // Timestamps
  createdAt      DateTime     @default(now()) @map("created_at")
  
  @@index([conversationId, createdAt])
  @@index([senderId])
  @@map("messages")
}

// ─── Safety & Moderation Models ────────────────────────────────

model Block {
  id        String   @id @default(uuid())
  blockerId String   @map("blocker_id")
  blockedId String   @map("blocked_id")
  blocker   User     @relation("BlockedBy", fields: [blockerId], references: [id], onDelete: Cascade)
  blocked   User     @relation("Blocks", fields: [blockedId], references: [id], onDelete: Cascade)
  
  // Timestamps
  createdAt DateTime @default(now()) @map("created_at")

  @@unique([blockerId, blockedId])
  @@index([blockerId])
  @@index([blockedId])
  @@map("blocks")
}

enum ReportReason {
  SPAM
  INAPPROPRIATE_CONTENT
  FAKE_LISTING
  SCAM
  HARASSMENT
  OTHER
}

enum ReportStatus {
  PENDING
  REVIEWED
  RESOLVED
  DISMISSED
}

model Report {
  id                String       @id @default(uuid())
  reporterId        String       @map("reporter_id")
  reporter          User         @relation("ReportsMade", fields: [reporterId], references: [id], onDelete: Cascade)
  
  // What is being reported (user or listing)
  reportedUserId    String?      @map("reported_user_id")
  reportedUser      User?        @relation("ReportsReceived", fields: [reportedUserId], references: [id], onDelete: Cascade)
  reportedListingId String?      @map("reported_listing_id")
  reportedListing   Listing?     @relation(fields: [reportedListingId], references: [id], onDelete: Cascade)
  
  // Report details
  reason            ReportReason
  description       String?      @db.VarChar(500)
  status            ReportStatus @default(PENDING)
  
  // Timestamps
  createdAt         DateTime     @default(now()) @map("created_at")
  updatedAt         DateTime     @updatedAt @map("updated_at")

  @@index([reporterId])
  @@index([reportedUserId])
  @@index([reportedListingId])
  @@index([status])
  @@map("reports")
}

model Favorite {
  id        String   @id @default(uuid())
  userId    String   @map("user_id")
  listingId String   @map("listing_id")
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  listing   Listing  @relation(fields: [listingId], references: [id], onDelete: Cascade)
  
  // Timestamps
  createdAt DateTime @default(now()) @map("created_at")

  @@unique([userId, listingId])
  @@index([userId])
  @@index([listingId])
  @@map("favorites")
}

// ─── Team System Models ─────────────────────────────────────

model Team {
  id          String       @id @default(uuid())
  name        String       @db.VarChar(100)
  description String?      @db.VarChar(500)
  budgetMin   Int?         @map("budget_min")
  budgetMax   Int?         @map("budget_max")
  city        String?
  
  // Team settings
  maxMembers  Int          @default(4) @map("max_members")
  isActive    Boolean      @default(true) @map("is_active")
  
  // Timestamps
  createdAt   DateTime     @default(now()) @map("created_at")
  updatedAt   DateTime     @updatedAt @map("updated_at")
  
  // Relations
  members       TeamMember[]
  conversations Conversation[]
  
  @@index([city, isActive])
  @@index([createdAt])
  @@map("teams")
}

model TeamMember {
  id        String           @id @default(uuid())
  teamId    String           @map("team_id")
  userId    String           @map("user_id")
  team      Team             @relation(fields: [teamId], references: [id], onDelete: Cascade)
  user      User             @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  role      TeamRole
  status    TeamMemberStatus @default(PENDING)
  
  // Timestamps
  createdAt DateTime         @default(now()) @map("created_at")
  updatedAt DateTime         @updatedAt @map("updated_at")
  
  @@unique([teamId, userId])
  @@index([userId])
  @@index([teamId, status])
  @@map("team_members")
}

// ─── Review System Model ────────────────────────────────────

model Review {
  id           String   @id @default(uuid())
  reviewerId   String   @map("reviewer_id")
  reviewedId   String   @map("reviewed_id")
  reviewer     User     @relation("ReviewsGiven", fields: [reviewerId], references: [id], onDelete: Cascade)
  reviewed     User     @relation("ReviewsReceived", fields: [reviewedId], references: [id], onDelete: Cascade)
  
  rating       Int      // 1-5 stars
  comment      String?  @db.VarChar(500)
  
  // Timestamps
  createdAt    DateTime @default(now()) @map("created_at")
  
  @@unique([reviewerId, reviewedId])
  @@index([reviewedId])
  @@index([createdAt])
  @@map("reviews")
}

// ─── Notification System Model ──────────────────────────────

model Notification {
  id        String           @id @default(uuid())
  userId    String           @map("user_id")
  user      User             @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  type      NotificationType
  title     String           @db.VarChar(100)
  message   String           @db.VarChar(500)
  
  // Optional references
  relatedUserId    String?  @map("related_user_id")
  relatedTeamId    String?  @map("related_team_id")
  relatedListingId String?  @map("related_listing_id")
  
  isRead    Boolean          @default(false) @map("is_read")
  
  // Timestamps
  createdAt DateTime         @default(now()) @map("created_at")
  
  @@index([userId, isRead, createdAt])
  @@map("notifications")
}

